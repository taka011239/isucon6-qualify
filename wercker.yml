deploy:
  steps:
    - script:
        name: make .ssh directory
        code: mkdir -p "$HOME/.ssh"
    - create-file:
        name: write ssh key
        filename: $HOME/.ssh/id_rsa
        overwrite: true
        hide-from-log: true
        content: $WERCKER_SSH_KEY_PRIVATE
    - script:
        name: set permissions for ssh key
        code: chmod 0400 $HOME/.ssh/id_rsa
   - script:
      name: stop application
      code: ssh -i $HOME/.ssh/id_rsa -l root -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no 13.78.80.139 stop stop isuda.python.service
      code: ssh -i $HOME/.ssh/id_rsa -l root -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no 13.78.80.139 stop stop isuda.python.service
   - script:
      name: transfer application
      code: |
        pwd
        ls -la
        scp -i $HOME/.ssh/id_rsa -o StrictHostKeyChecking=no -o UserKnownHostsFile=no isucon@13.78.80.139:/home/isucon/webapp
   - script:
      name: start application
      code: ssh -i $HOME/.ssh/id_rsa -l root -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no 13.78.80.139 systemctl start isuda.python.service
      code: ssh -i $HOME/.ssh/id_rsa -l root -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no 13.78.80.139 systemctl start isutar.python.service